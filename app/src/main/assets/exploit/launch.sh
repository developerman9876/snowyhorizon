#!/bin/sh
# kudos to https://github.com/zhuowei/cheese-app/blob/c7a34c75af85d6bae712536b71a1ece0f2a6457d/app/src/main/assets/cheese/launch.sh
echo "got root, doing magic fixes..."
cd "$(dirname "$0")"
umask 000
export FIRST_STAGE=1
export ASH_STANDALONE=1

echo "disabling ota updates to prevent a force update that patches the exploit"
pm disable-user --user 0 com.oculus.updater
pm disable-user  --user 0 com.oculus.nux.ota
echo "disabled ota updates, continuing..."

echo "checking for killswitch (meta should not have implemented this)" # your device is your own: part ?
if [ -f /persist/srt_push/token ]; then
    echo "killswitch found :O, dw i will delete it"
    rm /persist/srt_push/token
    echo "killswitch removed :D, continuing..."
else
    echo "no killswitch found :D, continuing..."
fi

echo "starting magisk setup... (may take a while, don't touch anything)"
exec ./busybox setsid ./busybox nsenter -m/proc/1/ns/mnt "$PWD/busybox" sh "$PWD/live_setup.sh" >/data/local/tmp/exploit_magisk_start.txt 2>&1